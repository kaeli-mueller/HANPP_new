[["index.html", "Reproducible Science: Final Project Chapter 1 Introduction", " Reproducible Science: Final Project Kaeli Mueller 2021-04-29 Chapter 1 Introduction My research project in this class is a subset of my overall research question for my masters thesis. My thesis will look at how the human appropriation of net primary production (HANPP) is related to biodiversity. HANPP can be thought of as a way of quantifying the footprint that humans have on the environment. The first studies of HANPP estimated that humans co-opt about 40% of global NPP every year (Vitousek et al., 1986). Subsequent research has investigated different methods of measuring HANPP, such as including different forms of consumption into the model, but there is a consistent trend of humans using about half of the global NPP (Haberl et al., 2014). For my thesis research I will be looking at HANPP as the human consumption of crops, timber, and grazing of land. It will be the first study looking at this measurement of HANPP for each county in the U.S. This could have implications about how human land use relates to important planetary boundaries. My project for this class will be visuallizing HANPP data in the form of bar graphs for each county in the the U.S. This will help conceptualize the idea of HANPP by breaking it into its different parts as well as helping to compare HANPP across different counties. Figure 1.1: Schema for how my r bar graphs will look The amount of net primary production (NPP) that humans use can affect the environment in different ways, but I will be focusing on how it affects biodiversity. This question falls within the framework of the species energy hypothesis, which postulates environments with more energy can support a higher number of species. For my study, energy will be measured in NPP, and I will be investigating different ways of quantifying species. There have been several studies looking at the relationship between energy and species (Cusens et al., 2012). There is generally a positive relationship between the two, although this relationship can get interrupted in instances of intensive human use (Gillman et al., 2015). I plan to apply this theory to my research because HANPP can also be used to measure the amount of NPP left in an ecosystem that humans do not use. This is done through subtracting the HANPP measurement from a modeled NPP value, and the result is ecological NPP, or NPPeco. This is an estimate of the real NPP in an ecosystem that is also being used by humans. I will compare this NPPeco measurement with biodiversity to see if there is a relationship. Biodiversity is a theoretical term that has many definitions, so often researchers use measurable factors that can represent biodiversity. I will be using the variables of species richness and abundance to study biodiversity. The datasets for species richness and abundance come at different scales, times, and from different sources, so I will have to figure out the abundance aspect of the data. I want to be able to identify the specific data I will use, represent it spatially, find out if there is a way to layer abundance for multiple species, and just understand these data better. I built an initial database ( 2 ) structure for my tables that plan to make with my data. My research question will contribute new information to the species-energy hypothesis, as well as to the idea of environmental footprints. There is a decent amount of literature about HANPP, but no one has every published anything about how HANPP affects biodiversity on a scale as large as the US. This research will also contribute to the literature about how spatial environmental factors can change greatly when portrayed at different scales, because I plan on using different data resolutions to compare results. My unique angle of looking at NPPeco and biodiversity will also contribute to the general research being done about the impacts that humans have on the environment. "],["database.html", "Chapter 2 Building the database", " Chapter 2 Building the database For my project I made an SQL database in R through the R package DBI. library(DBI) I wanted to make this project relevant to the research that I will be doing for my thesis. However, my project is still very much in the beginning stages and I dont have all the data gathered for it yet. So what I did was make a database with 3 tables structured the way that I thought would be useful. I will eventually be making some bar graphs from the HANPP_master spreadsheet, and later on I want to do an analysis with variables in each county. That is why I chose State_county to be the primary key. Figure 2.1: Schema for my database First I created an R project to establish a working directory. Then within that I created a database. hanpp_db_2 &lt;- dbConnect(drv = RSQLite::SQLite(), &quot;/data/HANPP.db&quot;) Next, I added tables to the database. This requires using SQL syntax and listing the name of each column and the type of variable it will be. #create main HANPP table dbExecute(hanpp_db_2, &quot;CREATE TABLE HANPP_main ( state_county varchar(30), total_HANPP integer(10), HANPP_used integer(10), HANPP_unused integer(10), HANPP_aboveground integer(10), HANPP_belowground integer(10), HANPP_total_grazing integer(10), HANPP_total_timber integer(10), HANPP_total_crops integer(10), PRIMARY KEY (state_county) );&quot;) #create table for the county scale dbExecute(hanpp_db_2, &quot;CREATE TABLE NPPeco_biodiversity_county ( county_id integer PRIMARY KEY, state_county varchar(30), NPPeco integer(10), species_richness varchar(10), abundance varchar(10), FOREIGN KEY (state_county) REFERENCES HANPP_master(state_county) );&quot;) #create table for the pixel scale dbExecute(hanpp_db_2, &quot;CREATE TABLE NPPeco_biodiversity_pixel ( county_id integer PRIMARY KEY, state_county varchar(30), NPPeco integer(10), species_richness varchar(10), abundance varchar(10), FOREIGN KEY (state_county) REFERENCES HANPP_master(state_county) );&quot;) Examine tables to see if the connection worked. dbListTables(hanpp_db_2) #&quot;HANPP_main&quot; &quot;NPPeco_biodiversity_county&quot; &quot;NPPeco_biodiversity_pixel&quot; class(hanpp_db_2) #[1] &quot;SQLiteConnection&quot; #attr(,&quot;package&quot;) #[1] &quot;RSQLite&quot; #It did work, but they are currently empty because I haven&#39;t added any of the csv data yet. "],["Data.html", "Chapter 3 Data Manipulation", " Chapter 3 Data Manipulation In this section I will be going through the steps to change the form of the data so that it is compatible with the ggplot syntax to make bar charts. I will be using tidyverse functions, as well as a specific function from the janitor library. library(tidyverse) library(janitor) I read in the raw data, which is in a large confusing spreadsheet. This spreadsheet is also incomplete, it doesnt contain all the needed data for the grazing sections. But we will make the plots look how they should and the code will work for the data when I do get it. I skip the very first line because it contains titles in merged cells. The janitor_names function is a really easy way to make names with unfortunate spaces in them into one character string so R can understand it. With this spreadsheet, its also important to make sure we select the right columns. Theres no shortcut around this, we just have to count the number of columns to make sure we are selecting the correct information. hanpp &lt;- read_csv(&quot;C:/Users/Kaeli/Documents/HANPP/hanpp_bar_graphs/HANPP_main_updated_2012.csv&quot;, skip = 1) %&gt;% janitor::clean_names() %&gt;% dplyr::select(county:year, corn_grain_1:total_grazing_1, total_hanpp = x45, total_used = x164, total_unused = x184, total_below_ground = x224, total_above_ground = x204) ## ## -- Column specification -------------------------------------------------------- ## cols( ## .default = col_double(), ## County = col_character(), ## State = col_character(), ## State_County = col_character(), ## `Spring Wheat Durum` = col_logical(), ## `Spring Wheat Durum_1` = col_logical(), ## `Spring Wheat Durum_2` = col_logical(), ## Hardwood_2 = col_logical(), ## Softwood_2 = col_logical(), ## `Total Timber_2` = col_logical(), ## `Spring Wheat Durum_3` = col_logical(), ## `Total Timber_3` = col_logical(), ## `BLM Grazing_3` = col_logical(), ## `USFS Grazing_3` = col_logical(), ## `Private Grazing Land_3` = col_logical(), ## `Total Grazing_3` = col_logical(), ## X84 = col_logical(), ## `Spring Wheat Durum_4` = col_logical(), ## `BLM Grazing_4` = col_logical(), ## `USFS Grazing_4` = col_logical(), ## `Private Grazing Land_4` = col_logical() ## # ... with 73 more columns ## ) ## i Use `spec()` for the full column specifications. I will examine the top row of the table to make sure it is the correct format head(hanpp) ## # A tibble: 6 x 28 ## county state state_county year corn_grain_1 corn_silage_1 winter_wheat_1 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 1.28 NA NA ## 2 BALDWIN ALABAMA ALABAMA_BALDW~ 2012 1.82 NA NA ## 3 BARBOUR ALABAMA ALABAMA_BARBO~ 2012 1.98 NA NA ## 4 BIBB ALABAMA ALABAMA_BIBB 2012 NA NA NA ## 5 BLOUNT ALABAMA ALABAMA_BLOUNT 2012 1.42 NA NA ## 6 BULLOCK ALABAMA ALABAMA_BULLO~ 2012 1.88 NA NA ## # ... with 21 more variables: spring_wheat_durum_1 &lt;lgl&gt;, ## # spring_wheat_excluding_durum_1 &lt;dbl&gt;, soybeans_1 &lt;dbl&gt;, ## # hay_alfalfa_1 &lt;dbl&gt;, cotton_pima_1 &lt;dbl&gt;, cotton_upland_1 &lt;dbl&gt;, ## # sorghum_1 &lt;dbl&gt;, other_crops_1 &lt;dbl&gt;, total_crops_1 &lt;dbl&gt;, ## # hardwood_1 &lt;dbl&gt;, softwood_1 &lt;dbl&gt;, total_timber_1 &lt;dbl&gt;, ## # blm_grazing_1 &lt;dbl&gt;, usfs_grazing_1 &lt;dbl&gt;, private_grazing_land_1 &lt;dbl&gt;, ## # total_grazing_1 &lt;dbl&gt;, total_hanpp &lt;dbl&gt;, total_used &lt;dbl&gt;, ## # total_unused &lt;dbl&gt;, total_below_ground &lt;dbl&gt;, total_above_ground &lt;dbl&gt; Now that we have the correct information, we have to imagine how it should look in the end to be plotted with ggplot. The aesthetics of our desired final plot are grams C / m2 / year (y), HANPP categories (x), and HANPP variable (sections within the bars). This means that grams of C per m2 per year needs to be a column, and the end result will be a dataframe that looks like this: data.frame(county = NA, state = NA, state_county = NA, year = NA, variable = NA, value = NA) ## county state state_county year variable value ## 1 NA NA NA NA NA NA So I know I have to pivot my data to make it longer instead of wider. I can do this with tidyverse functions. I am taking the data that used to be in columns and creating more columns. hanpp_long &lt;- hanpp %&gt;% pivot_longer(cols = corn_grain_1:total_above_ground, names_to = &quot;variable&quot;, values_to = &quot;gc_m2_yr&quot;) head(hanpp_long) ## # A tibble: 6 x 6 ## county state state_county year variable gc_m2_yr ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 corn_grain_1 1.28 ## 2 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 corn_silage_1 NA ## 3 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 winter_wheat_1 NA ## 4 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 spring_wheat_durum_1 NA ## 5 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 spring_wheat_excluding_durum_1 NA ## 6 AUTAUGA ALABAMA ALABAMA_AUTAUGA 2012 soybeans_1 0.779 Next we have to categorize each variable by which column we want the information to go into. We use the grepl function to sort variables based on what character strings they have in their names, and assign them to variables in a new column. hanpp_long &lt;- hanpp_long %&gt;% mutate(variable = case_when( variable == &quot;total_crops_1&quot; ~ &quot;total_crops&quot;, variable == &quot;total_timber_1&quot; ~ &quot;total_timber&quot;, variable == &quot;total_grazing_1&quot; ~ &quot;total_grazing&quot;, TRUE ~ variable )) %&gt;% mutate(category = case_when( grepl(pattern = &quot;_1&quot;, x = variable) ~ &quot;By specific product&quot;, variable %in% c(&quot;total_crops&quot;, &quot;total_timber&quot;, &quot;total_grazing&quot;) ~ &quot;By product&quot;, variable == &quot;total_hanpp&quot; ~ &quot;HANPP&quot;, grepl(pattern = &quot;above_ground&quot;, variable) ~ &quot;By location&quot;, grepl(pattern = &quot;below_ground&quot;, variable) ~ &quot;By location&quot;, grepl(pattern = &quot;used&quot;, variable) ~ &quot;By use&quot;, grepl(pattern = &quot;unused&quot;, variable) ~ &quot;By use&quot; )) head(hanpp_long) ## # A tibble: 6 x 7 ## county state state_county year variable gc_m2_yr category ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 corn_grain_1 1.28 By specific ~ ## 2 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 corn_silage_1 NA By specific ~ ## 3 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 winter_wheat_1 NA By specific ~ ## 4 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 spring_wheat_durum~ NA By specific ~ ## 5 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 spring_wheat_exclu~ NA By specific ~ ## 6 AUTAUGA ALABAMA ALABAMA_AUTA~ 2012 soybeans_1 0.779 By specific ~ We have one last data manipulation step, we have to order the columns. We do this by assigning factor levels to the different categories for each column. hanpp_long &lt;- hanpp_long %&gt;% mutate(category = factor(category, levels = c(&quot;HANPP&quot;, &quot;By use&quot;, &quot;By location&quot;, &quot;By product&quot;, &quot;By specific product&quot;))) After doing all the data manipulation, I can now change the names of variables to more visually pleasing names. This will make it easier to read them when they appear on the final bar chart. hanpp_long &lt;- hanpp_long %&gt;% mutate(variable = case_when( variable == &quot;corn_grain_1&quot; ~ &quot;Corn Grain&quot;, variable == &quot;corn_silage_1&quot; ~ &quot;Corn Silage&quot;, variable == &quot;winter_wheat_1&quot; ~ &quot;Winter Wheat&quot;, variable == &quot;spring_wheat_durum_1&quot; ~ &quot;Spring Wheat Durum&quot;, variable == &quot;spring_wheat_excluding_durum_1&quot; ~ &quot;Spring Wheat Excluding Durum&quot;, variable == &quot;soybeans_1&quot; ~ &quot;Soybeans&quot;, variable == &quot;hay_alfalfa_1&quot; ~ &quot;Hay Alfalfa&quot;, variable == &quot;cotton_pima_1&quot; ~ &quot;Cotton Pima&quot;, variable == &quot;total_crops_1&quot; ~ &quot;Total Crops&quot;, variable == &quot;hardwood_1&quot; ~ &quot;Hardwood&quot;, variable == &quot;softwood_11&quot; ~ &quot;Softwood&quot;, variable == &quot;private_grazing_land_1&quot; ~ &quot;Private Grazing&quot;, variable == &quot;total_timber_1&quot; ~ &quot;Total Timber&quot;, variable == &quot;blm_grazing_1&quot; ~ &quot;BLM Grazing&quot;, variable == &quot;usfs_grazing_1&quot; ~ &quot;USFS Grazing&quot;, variable == &quot;total_grazing_1&quot; ~ &quot;Total Grazing&quot;, variable == &quot;softwood_1&quot; ~ &quot;Softwood&quot;, variable == &quot;sorghum_1&quot; ~ &quot;Sorghum&quot;, variable == &quot;other_crops_1&quot; ~ &quot;Other Crops&quot;, variable == &quot;total_hanpp&quot; ~ &quot; &quot;, variable == &quot;total_used&quot; ~ &quot;Used&quot;, variable == &quot;total_hanpp&quot; ~ &quot;Unused&quot;, variable == &quot;total_below_ground&quot; ~ &quot;Below Ground&quot;, variable == &quot;total_above_ground&quot; ~ &quot;Above Ground&quot;, variable == &quot;total_crops&quot; ~ &quot;Total Crops&quot;, variable == &quot;total_grazing&quot; ~ &quot;Total Grazing&quot;, variable == &quot;total_timber&quot; ~ &quot;Total Timber&quot;, TRUE ~ variable )) head(hanpp_long) ## # A tibble: 6 x 7 ## county state state_county year variable gc_m2_yr category ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;fct&gt; ## 1 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Corn Grain 1.28 By specific ~ ## 2 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Corn Silage NA By specific ~ ## 3 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Winter Wheat NA By specific ~ ## 4 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Spring Wheat Durum NA By specific ~ ## 5 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Spring Wheat Excl~ NA By specific ~ ## 6 AUTAUGA ALABAMA ALABAMA_AUTAU~ 2012 Soybeans 0.779 By specific ~ "],["more.html", "Chapter 4 Data Visualization", " Chapter 4 Data Visualization Now that the data is in the correct format, I will use ggplot functions to plot it. First we will write code that works when we want to select a single county to plot. I used geom_text to show the names of the sections on the bars, although they are hard to read depending on the sections of each county. We can make different bar charts to compare urban vs. rural areas. ggplot(hanpp_long[which(hanpp_long$state_county == &quot;COLORADO_DENVER&quot;), ], aes(x = category, y = gc_m2_yr, fill = variable)) + geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;) + geom_text(aes(label = variable), position = &quot;stack&quot;, vjust = 1.5) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(x = &quot; &quot;, y = &quot;HANPP (gC/m2/year)&quot;) + ggtitle(&quot;HANPP Harvest in Denver County, Colorado (urban)&quot;) ggplot(hanpp_long[which(hanpp_long$state_county == &quot;COLORADO_PROWERS&quot;), ], aes(x = category, y = gc_m2_yr, fill = variable)) + geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;) + geom_text(aes(label = variable), position = &quot;stack&quot;, vjust = 1.5) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(x = &quot; &quot;, y = &quot;HANPP (gC/m2/year)&quot;) + ggtitle(&quot;HANPP Harvest Prowers County, Colorado (rural)&quot;) we can also see the difference between a county with really high HANPP harvest. An example of this is a county like Lyon County Iowa, which is in the corn belt of the U.S. The gC/m2/year is much higher here than the previous counties from Colorado, even the rural one. ggplot(hanpp_long[which(hanpp_long$state_county == &quot;IOWA_LYON&quot;), ], aes(x = category, y = gc_m2_yr, fill = variable)) + geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;) + geom_text(aes(label = variable), position = &quot;stack&quot;, vjust = 1.5) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(x = &quot; &quot;, y = &quot;HANPP (gC/m2/year)&quot;) + ggtitle(&quot;HANPP Harvest Lyon County, Iowa (high in corn products)&quot;) The bar charts also look different for counties in the Southeast, such as in Georgia. HANPP harvest is still very high, but her there is much more cotton and softwood timber being harvested. ggplot(hanpp_long[which(hanpp_long$state_county == &quot;GEORGIA_TOOMBS&quot;), ], aes(x = category, y = gc_m2_yr, fill = variable)) + geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;) + geom_text(aes(label = variable), position = &quot;stack&quot;, vjust = 1.5) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(x = &quot; &quot;, y = &quot;HANPP (gC/m2/year)&quot;) + ggtitle(&quot;HANPP Harvest Toombs County, Georgia (high in timber and cotton products)&quot;) We can also change this code to make it a loop. This would automate the process of making bar charts for all of the data, and save these plots in a designated folder. This is done by making a vector with a length of all the state_names, and using this to run through every county in our dataframe. for (i in 1:5) { county &lt;- unique(hanpp_long$state_county)[i] ggplot(hanpp_long[which(hanpp_long$state_county == county), ], aes(x = category, y = gc_m2_yr, fill = variable)) + geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;, color = &quot;black&quot;) + geom_text(aes(label = variable), position = &quot;stack&quot;, vjust = 1.5) + theme_minimal() + theme(legend.position = &quot;none&quot;) + labs(x = &quot; &quot;, y = &quot;HANPP (gC/m2/year)&quot;) + ggtitle(paste0(&quot;HANPP Harvest in_&quot;, county)) ggsave(filename = paste0(&quot;C:/Users/Kaeli/Documents/HANPP/hanpp_bar_graphs/new_bar_chart_&quot;, county, &quot;.tiff&quot;), height = 10, width = 10, compression = &quot;lzw&quot;, dpi = 300) } "],["references.html", "References", " References Special thanks to Simona Picardi and her help with very crucial steps of data manipulation. Cusens, J., Wright, S. D., McBride, P. D., &amp; Gillman, L. N. (2012). What is the form of the productivity-animal-species-richness relationship? a critical review and meta-analysis. Ecology, 93(10), 22412252. https://doi.org/10.1890/11-1861.1 Gillman, L. N., Wright, S. D., Cusens, J., Mcbride, P. D., Malhi, Y., &amp; Whittaker, R. J. (2015). Latitude, productivity and species richness. Global Ecology and Biogeography, 24(1), 107117. https://doi.org/10.1111/geb.12245 Haberl, H., Erb, K.-H., &amp; Krausmann, F. (2014). Human Appropriation of Net Primary Production: Patterns, Trends, and Planetary Boundaries. Annual Review of Environment and Resources, 39(1), 363391. https://doi.org/10.1146/annurev-environ-121912-094620 Vitousek, P. M., Ehrlich, P. R., Ehrlich, A. H., &amp; Matson, P. A. (1986). Human Appropriation of the Products of Photosynthesis. BioScience, 36(6), 368373. https://doi.org/10.2307/1310258 "]]
